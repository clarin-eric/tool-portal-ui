<!DOCTYPE html>
<!--
Copyright (C) 2025 twagoo

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
    <head th:replace="~{fragments/base :: head}">
        <title>CLARIN Tool Portal</title> 
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    </head>

    <body>
        <div class="container-xl">

            <!-- Page header -->
            <nav th:replace="~{fragments/base :: top-navigation('search')}">
                [Navigation]
            </nav>

            <main hx-swap="outerHTML show:none" hx-indicator="#search-results-and-facets">

                <!-- Search form -->
                <div class="m-3">
                    <form action="/search" hx-boost="true" hx-target="#search-results-and-facets">
                        <div class="d-flex">
                            <div class="ms-auto w-50 p-2">
                                <input type="search" class="form-control"
                                       name="q" th:value="${query}" />
                            </div>
                            <div class="p-2">
                                <input type="submit" class="btn btn-primary"
                                       th:value="#{search.form.buttonText}" />
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Search results and facets -->
                <div class="row" id="search-results-and-facets">

                    <!-- Facets -->
                    <section id="facets" class="col-lg-3">
                        <h2 class="h3" th:text="#{search.facets.resultFilters}">[Result filters]</h2>

                        <div th:unless="${facets}" th:text="#{search.facets.noInformation}">
                            [No facet information]
                        </div>
                        <div th:if="${facets}" th:replace="~{search/facets :: facets(${facets},${query},${searchFilters},${filterQueryMap})}">
                            [Facets]
                        </div>
                    </section>

                    <!-- Search results -->
                    <section id="search-results" class="col-lg-9">

                        <!-- Active filters -->
                        <div class="m-3 p-2 border rounded" th:unless="${filterQueryMap.isEmpty()}"
                             hx-boost="true"
                             hx-target="#search-results-and-facets"
                             hx-select="#search-results-and-facets">
                            <h2 class="h5">Active filters:
                                <a th:href="@{/search(q=${query})}" title="Clear all"><i class="fa-solid fa-xmark"></i></a></h2>
                            <ul>
                                <th:block th:each="key: ${filterQueryMap.keySet()}">
                                    <li th:each="value: ${filterQueryMap.get(key)}">
                                        [[|#{|fields.labels.${key}|}: ${value}|]]
                                        <a th:href="@{/search(q=${query},fq=${searchFilters},removefq=|${key}:${value}|)}"><i class="fa-solid fa-xmark"></i></a>
                                    </li>
                                </th:block>
                            </ul>
                        </div>

                        <div class="spinner-border htmx-indicator float-end" role="status">
                            <span class="visually-hidden" th:text="#{spinner.loading}">Loading...</span>
                        </div>

                        <div th:unless="${result}" th:text="#{search.results.noResults}">
                            [No search results]
                        </div>
                        <div th:if="${result}" th:replace="~{search/searchResults :: search-results(
                             query=${query},
                             result=${result},
                             currentPage=${currentPage},
                             pageCount=${pageCount},
                             resultsPerPage=${resultsPerPage})}">
                            [Search results]
                        </div>
                    </section>

                </div>
            </main>

            <footer th:replace="~{fragments/base :: footer}"></footer>

        </div>
    </body>
</html>
