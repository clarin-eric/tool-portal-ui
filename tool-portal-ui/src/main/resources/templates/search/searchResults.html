<!DOCTYPE html>
<!--
Copyright (C) 2025 twagoo

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>

    <body>
        <div th:fragment="search-results(query, result, currentPage, pageCount, resultsPerPage)">

            <div>[[${result.numFound}]] record(s) found</div>

            <div th:if="${result.numFound > 0}" th:object="${result}">
                <!--                 th:with="pageSize = ${resultsPerPage}?:10,
                                 pageCount=${result.numFound / pageSize},
                                 currentPage=${1 + (result.start / pageSize)}">-->
                <h2>Search results</h2>

                <nav th:replace="~{:: pagination(${query}, ${currentPage},${pageCount},${resultsPerPage})}">
                    [Pagination]
                </nav>

                <ul id="results-list" class="d-block ps-0">
                    <li class="card mb-2 p-2" th:each="record: *{records}">
                        <article th:object="${record}">
                            <h3>
                                <a th:href="|records/${record.id}|">
                                    <span th:if="*{fields['name']}" th:text="*{fields.name[0]}">Record title</span>
                                    <span th:unless="*{fields['name']}">Untitled record</span>
                                </a>
                            </h3>
                            <div th:if="*{fields['description']}" th:each="description:*{fields['description']}">
                                <div th:text="${description}">description</div>
                            </div>
                        </article>
                    </li>
                </ul>

                <nav th:replace="~{:: pagination(${query}, ${currentPage},${pageCount},${resultsPerPage})}">
                    [Pagination]
                </nav>

            </div> <!-- more than 0 results -->
        </div>

        <!-- Pagination -->
        <nav th:fragment="pagination(query, currentPage, pageCount, resultsPerPage)" aria-label="Page navigation for search results"
             th:with="linkCount=7">
            <ul class="pagination"
                hx-target="#search-results"
                hx-select="#search-results"
                hx-params="*">

                <!-- Previous page -->
                <th:block th:if="${currentPage > 1}">
                    <li th:replace="~{::paginationLink('Previous',${currentPage - 1},${query},${currentPage},${resultsPerPage})}"></li>
                </th:block>
                <th:block th:if="${currentPage <= 1}">
                    <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                </th:block>

                <!-- First page -->
                <th:block th:if="${currentPage > (1+linkCount/2)}">
                    <li th:replace="~{::paginationLink('1',1,${query},${currentPage},${resultsPerPage})}"></li>
                    <li th:if="${currentPage > (2+linkCount/2)}" class="page-item disabled"><span class="page-link">...</span></li>
                </th:block>

                <!-- Page numbers -->
                <th:block th:with="start=${(currentPage <= linkCount / 2) ? 1 : currentPage-(linkCount/2)},
                          end=${((start + linkCount) < pageCount) ? (start+linkCount) : pageCount}">
                    <!--[[|${start} -> ${end}|]]-->
                    <th:block th:each="page: ${#numbers.sequence(start,end)}">
                        <li th:replace="~{::paginationLink(${page},${page},${query},${currentPage},${resultsPerPage})}"></li>
                    </th:block>
                </th:block>

                <!-- Last page -->
                <th:block th:if="${currentPage + 1 < (pageCount - linkCount/2)}">
                    <li th:if="${currentPage + 2 < (pageCount - linkCount/2)}" class="page-item disabled"><span class="page-link">...</span></li>
                    <li th:replace="~{::paginationLink(${pageCount},${pageCount},${query},${currentPage},${resultsPerPage})}"></li>
                </th:block>

                <!-- Next page -->
                <th:block th:if="${currentPage < pageCount}">
                    <li th:replace="~{::paginationLink('Next',${currentPage + 1},${query},${currentPage},${resultsPerPage})}"></li>
                </th:block>
                <th:block th:if="${currentPage >= pageCount}">
                    <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
                </th:block>
            </ul>
        </nav>

        <!-- Link in the search result pagination -->
    <li th:fragment="paginationLink(label, pageNumber, query, currentPage, resultsPerPage)" class="page-item">
        <a class="page-link" th:classappend="${pageNumber == currentPage} ? 'active'" 
           hx-boost="true"
           th:href="@{/search(
           q=${query},
           from=${(pageNumber - 1) * resultsPerPage},
           size=${resultsPerPage})}"
           th:text="${label}">[NUMBER]</a>
    </li>

</body>
</html>
