<!DOCTYPE html>
<!--
Copyright (C) 2025 twagoo

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>

    <body>
        <div th:fragment="search-results(query, result, currentPage, pageCount, resultsPerPage)">

            <div th:text="#{search.results.recordsFound(${result.numFound})}">N record(s) found</div>

            <div th:if="${result.numFound > 0}" th:object="${result}">
                <h2 th:text="#{search.results.searchResults}">[Search results]</h2>

                <nav th:replace="~{search/pagination :: pagination(${query}, ${currentPage},${pageCount},${resultsPerPage})}">
                    [Pagination]
                </nav>

                <ul id="results-list" class="d-block ps-0">
                    <li class="card mb-2 p-2" th:each="record: *{records}">
                        <article th:replace=":: resultItem(${record})">
                            [result item]
                        </article>
                    </li>
                </ul>

                <div hx-swap="outerHTML show:top">
                    <nav th:replace="~{search/pagination :: pagination(${query}, ${currentPage},${pageCount},${resultsPerPage})}">
                        [Pagination]
                    </nav>
                </div>
            </div> <!-- more than 0 results -->
        </div>

        <!-- Single search result item (representing a record or record group) -->
        <article th:fragment="resultItem(record)" th:object="${record}">
            <h3>
                <a th:href="|records/${record.id}|"
                   th:hx-get="|records/${record.id}?backLink=true|"
                   th:hx-push-url="|records/${record.id}|"
                   hx-target="main" hx-select="main" hx-swap="outerHTML">
                    <span th:if="*{fields['name']}" th:text="*{fields.name[0]}">[Record title]</span>
                    <span th:unless="*{fields['name']}" th:text="#{record.untitleRecord}">[Untitled record]</span>
                </a>
            </h3>
            <div class="badge bg-info" th:text="#{search.result.resourceCount(*{fields['_resourceRefCount'][0]})}">
                [N resources]
            </div>
            <div class="mb-2" th:if="*{fields['description']}" th:each="description:*{fields['description']}">
                <div th:text="${description}">[description]</div>
            </div>
            <div class="mb-2">
                <div class="mb-1" th:if="*{landingPages}">
                    <div  th:each="landingPage: *{landingPages}">
                        <a th:href="${landingPage.ref}" class="btn btn-outline-primary">
                            <i class="fa-solid fa-bolt"></i>
                            [[*{fields['name']}?#{record.useToolLink(*{fields['name'][0]})}:#{record.useToolLinkUntitled}]]
                        </a>
                    </div>
                </div>
            </div>
        </article>

    </body>
</html>
