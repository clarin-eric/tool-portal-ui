<!DOCTYPE html>
<!--
Copyright (C) 2025 twagoo

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>

    <body>
    <th:block th:if="${facet}">
        <h1 th:text="${facet.name}">[facet]</h1>
        <div th:replace="~{:: facetValues(
             facet=${facet}, 
             selection=${filterQueryMap[facet.name]},
             query=${query}, 
             searchFilters=${searchFilters},
             valueCount=${size}?:10)}">[Facet values]</div>
    </th:block>
    <th:block th:unless="${facet}">
        Facet not found
    </th:block>

    <th:block th:remove="all">

        <div th:fragment="facetValues(facet,selection, query,
             searchFilters, valueCount)" 
             th:class="facet-values"
             th:id="|facet-values-${facet.name}|">
            <!-- Selected values -->
            <ul th:if="${selection}" class="m-0 p-0" style="list-style: none;">
                <li th:each="selected : ${selection}">
                    [[${selected}]]
                    <a th:href="@{/search(q=${query},fq=${searchFilters},removefq=|${facet.name}:${selected}|)}"><i class="fa-solid fa-xmark"></i></a>
                </li>
            </ul>

            <!-- Unselected values with counts -->
            <ul class="m-0 p-0" style="list-style: none;">
                <th:block th:each="facetValue : ${facet.values}">
                    <li th:unless="${selection} and ${#lists.contains(selection, facetValue.value)}"
                        class="p-0 m-0">
                        <a th:href="@{/search(q=${query},fq=${searchFilters},addfq=|${facet.name}:${facetValue.value}|)}">[[${facetValue.value}]]</a>
                        ([[${facetValue.count}]])
                    </li>
                </th:block>
            </ul>

            <div th:if="${facet.hasMore ?: true}" class="mt-3 pt-1 border-top">
                <a th:href="@{/search/values/{facet}(
                   facet=${facet.name},q=${query},fq=${searchFilters},
                   size=${valueCount+5})}"
                   th:hx-get="@{/search/values/{facet}(
                   facet=${facet.name},q=${query},fq=${searchFilters},
                   size=${valueCount+5})}"
                   hx-swap="innerHTML"
                   hx-target="closest .facet-values"
                   th:hx-select="|#facet-values-${facet.name}|"
                   >...more</a>
            </div>
        </div>
    </th:block>

</body>
</html>
