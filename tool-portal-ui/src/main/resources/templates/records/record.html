<!DOCTYPE html>
<!--
Copyright (C) 2025 twagoo

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
    <head th:replace="~{fragments/base :: head}">
        <title>CLARIN Tool Portal</title> 
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    </head>

    <body>
        <div class="container-xl">

            <nav th:replace="~{fragments/base :: top-navigation('record')}">
                [Navigation]
            </nav>

            <main th:object="${record}">


                <div class="mt-3">
                    <form action="/search">
                        <div th:replace="~{search/search :: searchFormContents('', null)}"></div>
                    </form>
                </div>

                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/}">Home</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/search(q=${query},fq=${searchFilters})}">Search</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Record</li>
                    </ol>
                </nav>

                <div class="container-md">
                    <div class="row mt-md-2">
                        <div class="col-md-8">
                            <h1 th:text="*{fields?.name[0]}">Title</h1>
                        </div>

                        <div class="col-md-4">
                            <div th:if="*{landingPages}" class="mt-2 mb-2">
                                <div  th:each="landingPage: *{landingPages}">
                                    <a th:href="${landingPage.ref}" class="btn btn-primary p-3">
                                        <i class="fa-solid fa-bolt"></i>
                                        [[*{fields['name']}?#{record.useToolLink(*{fields['name'][0]})}:#{record.useToolLinkUntitled}]]
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-8">

                            <div th:replace="~{ :: mainContentTabs(
                                 record=${record}, tab=${tab}, xml=${xml})}">
                                [TABBED "MAIN" CONTENT (Default: overview) + NAVS]
                            </div>

                        </div>
                        <div class="col-md-4">

                            <div class="me-2">
                                <div class="mb-2" th:each="field: ${ {
                                     'creator','organisation','license'} }">
                                    <th:block th:if="${#maps.containsKey(record.fields, field)}">
                                        <strong>[[ #{|fields.labels.${field}|} ]]:</strong><br />
                                        [[ ${record.fields[__${field}__]} ]]
                                    </th:block>
                                </div>
                            </div>

                            <div th:if="*{resources}" class="mt-2 mb-2">
                                <h2 class="h5">Resources:</h2>
                                <div class="card mb-2" th:each="resource: *{resources}">
                                    <div class="card-body">
                                        <h3 class="h5 card-title">Resource</h3>
                                        <div th:if="${resource.mediaType}" class="h6 card-subtitle mb-2 text-body-secondary">[[${resource.mediaType}]]</div>
                                        <div th:unless="${resource.mediaType}" class="h6 card-subtitle mb-2 text-body-secondary">Unknown type</div>
                                        <div>
                                            <a class="btn btn-outline-secondary btn-sm" th:href="${resource.ref}">
                                                <i class="fa-solid fa-cloud-arrow-down"></i>
                                                Access
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <footer th:replace="~{fragments/base :: footer}"></footer>

        </div>
    </body>

    <th:block th:remove="all">

        <!-- Tabbed main content section -->

        <div th:fragment="mainContentTabs(record, tab, xml)"
             th:with="recordId = ${record.id}">

            <ul id="mainContentTabsNav" th:fragment="mainContentTabsNav(recordId, tab)" 
                class="nav nav-underline border-bottom" 
                hx-boost="true"
                hx-target="#recordTabsContent"
                hx-swap="innerHTML show:none">

                <li th:replace="~{ :: mainContentNavItem(tab=${tab},
                    current='overview', href=@{/records/{id}(id=${recordId})}, 
                    hxSelect='#recordOverview', label='Overview')}">[Overview]</li>

                <li th:replace="~{ :: mainContentNavItem(tab=${tab},
                    current='metadata', href=@{/records/{id}/metadata(id=${recordId})},
                    hxSelect='#recordAllMetadata', label='Detailed metadata')}">[Detailed metadata]</li>

                <li th:replace="~{ :: mainContentNavItem(tab=${tab},
                    current='links', href=@{/records/{id}/links(id=${recordId})},
                    hxSelect='#recordLinks', label='Links')}">[Links]</li>
            </ul>

            <div id="recordTabsContent" class="pt-2"
                 th:switch="${tab}">

                <div th:case="metadata">
                    <div th:replace="~{records/allMetadata :: allMetadata(${xml})}">[overview]</div>
                </div>

                <div th:case="links">
                    <div>Links: TODO</div>
                </div>

                <div th:case="*">
                    <div th:replace="~{records/overview :: overview(${record})}">[overview]</div>
                </div>
            </div>
        </div>

        <!-- Nav item for main content section -->
        <li th:fragment="mainContentNavItem(tab, current,href,hxSelect,label)" class="nav-item">
            <a class="nav-link"
               hx-select-oob="#mainContentTabsNav"
               th:aria-current="${tab == current} ? 'page'"
               th:classappend="${tab == current} ? 'active'"
               th:href="${href}"
               th:hx-select="${hxSelect}">[[${label}]]</a>
    </th:block>
</html>
